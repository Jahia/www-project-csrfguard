# This workflow is triggered every time a change is pushed to any branches
# Github actions command reference: https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
name: On Code Change

# The workflow could also be triggered on PRs
on:
  push:
    branches:
      - '**'
    tags-ignore:
      - '**'

jobs:
  build:
    name: Build Module
    runs-on: ubuntu-latest
    steps:          
      - uses: actions/checkout@v2  
      - uses: jahia/jahia-modules-action/build@v1
        with:
          module_id: www-project-csrfguard
          mvn_settings_filepath: .github/maven.settings.xml

  publish:
    name: Publish module
    needs: [build]
    if: github.ref == 'refs/heads/jahia-ci'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: jahia/jahia-modules-action/publish@v1
        with:
          nexus_username: ${{ secrets.NEXUS_USERNAME }}
          nexus_password: ${{ secrets.NEXUS_PASSWORD }}
